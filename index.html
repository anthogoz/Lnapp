<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirection en cours...</title>
    <style>
        /* --- Base & Typographie --- */
        :root {
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #1DB954;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Conteneur Principal (La Carte) --- */
        .content-wrapper {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
        }

        /* --- CORRECTION MISE EN PAGE : Conteneur Flex Vertical --- */
        .flex-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* --- Éléments --- */
        #service-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .message {
            font-size: 1.1em;
            line-height: 1.5;
            color: var(--text-secondary);
            text-align: center;
        }

        .message b { color: var(--text-primary); }

        .loader-spinner {
            border: 6px solid #444;
            border-top-color: var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.5s linear infinite;
        }

        /* --- Boutons et Liens --- */
        .open-app-btn {
            background-color: var(--accent-color);
            color: var(--text-primary);
            width: 100%;
            padding: 16px;
            border-radius: 50px;
            font-weight: bold;
            text-decoration: none;
            font-size: 1em;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        .open-app-btn:hover { transform: scale(1.03); filter: brightness(1.1); }
        .btn-deezer { color: #121212; }
        
        .open-web-link { color: var(--text-secondary); text-decoration: none; transition: color 0.2s ease; }
        .open-web-link:hover { color: var(--text-primary); text-decoration: underline; }

        .hidden { display: none !important; }
        #version-note { position: fixed; bottom: 10px; right: 15px; font-size: 0.7em; color: #444; opacity: 0.8; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="main-content" class="content-wrapper">
        <!-- CORRECTION : Ajout de la classe .flex-container -->
        <div id="loader-container" class="flex-container">
            <p id="loader-message" class="message">Redirection en cours...</p>
            <div id="loader-spinner" class="loader-spinner"></div>
        </div>
        <!-- CORRECTION : Ajout de la classe .flex-container -->
        <div id="landing-page" class="flex-container hidden">
            <div id="service-icon"></div>
            <p id="landing-message" class="message">Ouvrir avec :</p>
            <a id="open-app-btn" class="open-app-btn" href="#">Ouvrir dans l'application</a>
            <a id="open-web-link" class="open-web-link" href="#">Continuer sur le site web</a>
        </div>
    </div>
    <span id="version-note">v2.0</span>

    <script>
        // CORRECTION MAJEURE : Les icônes sont maintenant intégrées et "inratables"
        const config = {
            spotify: { name: "Spotify", method: "protocol", accent: "#1DB954", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.19 14.39c-.24.36-.69.46-1.05.22-2.9-1.78-6.52-2.19-10.87-1.2C4.1 15.46 3.8 15.1 3.86 14.9s.3-.4.46-.34c4.68-1.05 8.58-.6 11.75 1.32.36.24.46.69.22 1.05zm1.2-2.67c-.29.43-.84.58-1.27.29-3.23-1.98-8.15-2.58-11.91-1.42-.45.13-.9-.16-.9-.63s.16-.9.63-.9c4.26-1.28 9.61-.63 13.26 1.58.43.29.58.84.29 1.27zm.12-2.79C13.2 8.65 7.6 8.44 4.46 9.4c-.55.16-1.11-.2-1.27-.75s.2-1.11.75-1.27c3.6-1.08 9.77-.85 13.63 1.58.49.3.68.94.38 1.43s-.94.68-1.43.38z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `spotify://track/${id}`, webUrl: (id) => `https://open.spotify.com/track/${id}` },
            youtube: { name: "YouTube", method: "protocol", accent: "#FF0000", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M21.58 7.19c-.23-.86-1.01-1.58-1.87-1.74C18.25 5 12 5 12 5s-6.25 0-7.71.45c-.86.16-1.64.88-1.87 1.74C2 8.7 2 12 2 12s0 3.3.42 4.81c.23.86 1.01 1.58 1.87 1.74C5.75 19 12 19 12 19s6.25 0 7.71-.45c.86-.16 1.64-.88 1.87-1.74C22 15.3 22 12 22 12s0-3.3-.42-4.81zM9.75 15.5V8.5l6.5 3.5-6.5 3.5z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `vnd.youtube://${id}`, webUrl: (id) => `https://www.youtube.com/watch?v=${id}` },
            deezer: { name: "Deezer", className: "deezer", method: "protocol", accent: "#00D3EC", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M3 6h3v3H3V6zm4.5 0h3v3h-3V6zM12 6h3v3h-3V6zm4.5 0h3v3h-3V6zm-9 4.5h3v3h-3v-3zm4.5 0h3v3h-3v-3zm4.5 0h3v3h-3v-3zM3 15h3v3H3v-3zm4.5 0h3v3h-3v-3z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `deezer://track/${id}`, webUrl: (id) => `https://www.deezer.com/track/${id}` },
            soundcloud: { name: "SoundCloud", method: "universal", accent: "#FF5500", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M3.4 10.3c.7 0 1.2.1 1.7.3.5.2.9.5 1.3.9l.1.1c.3.4.6.8.8 1.3.2.5.3 1.1.3 1.7 0 .7-.1 1.3-.4 1.9-.3.6-.6 1.1-1.1 1.5-.5.4-1 .7-1.6.9-.6.2-1.2.3-1.9.3H0V10.3h3.4zM11.9 9c1.1 0 2.1.2 3 .6.9.4 1.7.9 2.4 1.6.7.7 1.2 1.5 1.5 2.5.3 1 .5 2 .5 3.2 0 1.2-.2 2.3-.6 3.3-.4 1-.9 1.9-1.6 2.6-.7.7-1.6 1.3-2.6 1.7-1 .4-2.1.6-3.2.6h-2.1V9h2.2zm9.1-3.6V24h2V5.4h-2z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `https://soundcloud.com/${id}`, webUrl: (id) => `https://soundcloud.com/${id}` },
            applemusic: { name: "Apple Music", method: "universal", accent: "#FA243C", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M16.88 18.33c-.02 0-.04 0-.07 0-1.03-.2-1.7-.82-2.31-1.42-.61-.6-1.13-1.42-1.13-2.43 0-1.15.58-1.92 1.2-2.5.64-.6 1.48-.95 2.38-.95.04 0 .08 0 .12 0 .88.08 1.8.54 2.5 1.24-.02-.02-1.53 1.2-1.53 3.12 0 2.15 1.83 3.05 1.85 3.07-.63.98-1.5 1.5-2.58 1.6zM14.54 8.5c.3-.38.54-.84.7-1.35C14.28 6.6 13.06 6.2 11.9 6.2c-1.63 0-3.15.82-4.05 2.2-.8.95-1.43 2.3-1.43 3.65 0 2.9 2.17 4.97 4.3 4.97 1.05 0 2.05-.5 2.83-1.27.75-.75 1.2-1.8 1.22-1.82-.02 0-1.95-.5-1.95-2.92 0-2.15 1.6-2.9 1.68-2.96z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `https://music.apple.com/${id}`, webUrl: (id) => `https://music.apple.com/${id}` },
            itunes: { name: "iTunes", method: "protocol", accent: "#A247A8", icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.5 14.25V8.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v4.61c.6-.33 1.29-.51 2-.51 2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4c0-.71.18-1.4.51-2L10.5 16.25zM16 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z' fill='%23fff'/%3E%3C/svg%3E", appUrl: (id) => `itms://itunes.apple.com/${id}`, webUrl: (id) => `https://itunes.apple.com/${id}` }
        };

        // Le reste du JS est identique à la v1.8, il est déjà parfait.
        function isMobile() { return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const service = urlParams.get('service');
            const contentId = urlParams.get('id');
            const currentService = config[service];

            if (!currentService || !contentId) {
                document.getElementById('main-content').innerHTML = '<p class="message">Erreur : Service ou ID manquant dans l\'URL.</p>';
                return;
            }

            document.documentElement.style.setProperty('--accent-color', currentService.accent);
            const appUrl = currentService.appUrl(contentId);
            const webUrl = currentService.webUrl(contentId);

            document.getElementById('service-icon').style.backgroundImage = `url("${currentService.icon}")`;
            const openAppBtn = document.getElementById('open-app-btn');
            openAppBtn.href = appUrl;
            openAppBtn.textContent = `Ouvrir dans ${currentService.name}`;
            if (currentService.className === 'deezer') openAppBtn.classList.add('btn-deezer');
            document.getElementById('open-web-link').href = webUrl;

            const loaderContainer = document.getElementById('loader-container');
            const landingPageContainer = document.getElementById('landing-page');
            const landingMessage = document.getElementById('landing-message');

            if (isMobile()) {
                if (currentService.method === 'universal') {
                    loaderContainer.classList.add('hidden');
                    landingPageContainer.classList.remove('hidden');
                } else {
                    document.getElementById('loader-message').innerHTML = `Tentative d'ouverture de <b>${currentService.name}</b>...`;
                    let fallbackTimer;
                    const handleVisibilityChange = () => { if (document.hidden) { clearTimeout(fallbackTimer); } };
                    document.addEventListener("visibilitychange", handleVisibilityChange);
                    fallbackTimer = setTimeout(() => {
                        landingMessage.innerHTML = "L'ouverture automatique a échoué. <br>Veuillez choisir une option :";
                        loaderContainer.classList.add('hidden');
                        landingPageContainer.classList.remove('hidden');
                    }, 2500);
                    window.location.href = appUrl;
                }
            } else {
                document.getElementById('loader-message').innerHTML = `Redirection vers <b>${currentService.name}</b>...`;
                window.location.href = appUrl;
                setTimeout(() => { window.location.href = webUrl; }, 1000);
            }
        };
    </script>
</body>
</html>