<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirection en cours...</title>
    <style>
        /* --- Base & Typographie --- */
        :root {
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #1DB954; /* Couleur par défaut */
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            margin: 0;
            
            /* Centrage parfait de la carte */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Conteneur Principal (La Carte) --- */
        .content-wrapper {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 400px; /* Limite la largeur sur grand écran */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;

            /* Aligne les éléments à l'intérieur avec des espacements parfaits */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; /* Espace magique entre chaque élément */
        }

        /* --- Éléments de la carte --- */
        #service-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background-size: cover;
            background-position: center;
        }

        .message {
            font-size: 1.1em;
            line-height: 1.5;
            color: var(--text-secondary);
            text-align: center;
        }

        .message b {
            color: var(--text-primary);
        }

        .loader-spinner {
            border: 6px solid #444;
            border-top-color: var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.5s linear infinite;
        }

        /* --- Boutons et Liens --- */
        .open-app-btn {
            background-color: var(--accent-color);
            color: var(--text-primary);
            width: 100%;
            padding: 16px;
            border-radius: 50px;
            font-weight: bold;
            text-decoration: none;
            font-size: 1em;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        
        .open-app-btn:hover {
            transform: scale(1.03);
            filter: brightness(1.1);
        }
        
        /* Ajustement couleur texte pour les boutons clairs */
        .btn-deezer { color: #121212; }
        
        .open-web-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .open-web-link:hover {
            color: var(--text-primary);
            text-decoration: underline;
        }

        /* --- Gestion de l'affichage --- */
        .hidden { display: none !important; }

        /* --- Version & Animation --- */
        #version-note {
            position: fixed;
            bottom: 10px;
            right: 15px;
            font-size: 0.7em;
            color: #444;
            opacity: 0.8;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Structure HTML revue pour la carte -->
    <div id="main-content" class="content-wrapper">
        
        <!-- Conteneur pour le Loader (affiché par défaut) -->
        <div id="loader-container" class="container">
            <p id="loader-message" class="message">Redirection en cours...</p>
            <div id="loader-spinner" class="loader-spinner"></div>
        </div>

        <!-- Conteneur pour la page de choix (caché par défaut) -->
        <div id="landing-page" class="container hidden">
            <div id="service-icon"></div>
            <p id="landing-message" class="message">Ouvrir avec :</p>
            <a id="open-app-btn" class="open-app-btn" href="#">Ouvrir dans l'application</a>
            <a id="open-web-link" class="open-web-link" href="#">Continuer sur le site web</a>
        </div>

    </div>

    <span id="version-note">v1.9</span>

    <script>
        // Le JavaScript reste exactement le même que la v1.8, il n'y a rien à changer !
        const config = {
            spotify: { name: "Spotify", className: "spotify", method: "protocol", accent: "#1DB954", icon: "https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg", appUrl: (id) => `spotify://track/${id}`, webUrl: (id) => `https://open.spotify.com/track/${id}` },
            youtube: { name: "YouTube", className: "youtube", method: "protocol", accent: "#FF0000", icon: "https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg", appUrl: (id) => `vnd.youtube://${id}`, webUrl: (id) => `https://www.youtube.com/watch?v=${id}` },
            deezer: { name: "Deezer", className: "deezer", method: "protocol", accent: "#00D3EC", icon: "https://upload.wikimedia.org/wikipedia/commons/c/c5/Deezer_logo.svg", appUrl: (id) => `deezer://track/${id}`, webUrl: (id) => `https://www.deezer.com/track/${id}` },
            itunes: { name: "iTunes", className: "itunes", method: "protocol", accent: "#A247A8", icon: "https://upload.wikimedia.org/wikipedia/commons/5/57/ITunes_logo.svg", appUrl: (id) => `itms://itunes.apple.com/${id}`, webUrl: (id) => `https://itunes.apple.com/${id}` },
            applemusic: { name: "Apple Music", className: "applemusic", method: "universal", accent: "#FA243C", icon: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Apple_Music_icon.svg", appUrl: (id) => `https://music.apple.com/${id}`, webUrl: (id) => `https://music.apple.com/${id}` },
            soundcloud: { name: "SoundCloud", className: "soundcloud", method: "universal", accent: "#FF5500", icon: "https://upload.wikimedia.org/wikipedia/commons/a/a2/SoundCloud_logo.svg", appUrl: (id) => `https://soundcloud.com/${id}`, webUrl: (id) => `https://soundcloud.com/${id}` }
        };

        function isMobile() { return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const service = urlParams.get('service');
            const contentId = urlParams.get('id');
            const currentService = config[service];

            if (!currentService || !contentId) {
                document.getElementById('main-content').innerHTML = '<p class="message">Erreur : Service ou ID manquant dans l\'URL.</p>';
                return;
            }

            // Personnalisation dynamique des couleurs
            document.documentElement.style.setProperty('--accent-color', currentService.accent);

            const appUrl = currentService.appUrl(contentId);
            const webUrl = currentService.webUrl(contentId);

            // Préparation de la page de choix (pour tous les cas)
            document.getElementById('service-icon').style.backgroundImage = `url(${currentService.icon})`;
            document.getElementById('open-app-btn').href = appUrl;
            document.getElementById('open-app-btn').textContent = `Ouvrir dans ${currentService.name}`;
            if (currentService.className === 'deezer') {
                 document.getElementById('open-app-btn').classList.add('btn-deezer');
            }
            document.getElementById('open-web-link').href = webUrl;

            // Logique de redirection
            const loaderContainer = document.getElementById('loader-container');
            const landingPageContainer = document.getElementById('landing-page');
            const landingMessage = document.getElementById('landing-message');

            if (isMobile()) {
                if (currentService.method === 'universal') {
                    loaderContainer.classList.add('hidden');
                    landingPageContainer.classList.remove('hidden');
                } else {
                    document.getElementById('loader-message').innerHTML = `Tentative d'ouverture de <b>${currentService.name}</b>...`;
                    let fallbackTimer;
                    const handleVisibilityChange = () => { if (document.hidden) { clearTimeout(fallbackTimer); }};
                    document.addEventListener("visibilitychange", handleVisibilityChange);

                    fallbackTimer = setTimeout(() => {
                        landingMessage.innerHTML = "L'ouverture automatique a échoué. <br>Veuillez choisir une option :";
                        loaderContainer.classList.add('hidden');
                        landingPageContainer.classList.remove('hidden');
                    }, 2500);
                    
                    window.location.href = appUrl;
                }
            } else {
                document.getElementById('loader-message').innerHTML = `Redirection vers <b>${currentService.name}</b>...`;
                window.location.href = appUrl;
                setTimeout(() => { window.location.href = webUrl; }, 1000);
            }
        };
    </script>
</body>
</html>